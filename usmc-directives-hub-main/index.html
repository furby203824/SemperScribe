<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Content Security Policy for enhanced security -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' https://unpkg.com/web-vitals@3.5.0/;
  style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
  img-src 'self' data: https:;
  connect-src 'self'
    https://www.marines.mil
    https://www.mynavyhr.navy.mil
    https://www.secnav.navy.mil
    https://www.igmc.marines.mil
    https://www.esd.whs.mil
    https://comptroller.defense.gov
    https://www.travel.dod.mil
    https://usmc-directives-proxy.onrender.com
    http://localhost:3000
    https://corsproxy.io
    https://api.allorigins.win
    https://cors-anywhere.herokuapp.com
    https://api.codetabs.com;
  font-src 'self' data: https://cdnjs.cloudflare.com;
  object-src 'none';
  base-uri 'self';
  form-action 'self';
  upgrade-insecure-requests;
">
<!-- Additional Security Headers -->
<!-- Note: X-Frame-Options only works via HTTP headers, not meta tags -->
<!-- Configure at hosting level (GitHub Pages, Render, etc.) for frame protection -->
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=(), usb=()">
<title>Message Watch by Semper Admin</title>
<meta name="description" content="Monitor military directives, messages, and publications. Track MARADMINs, ALMARs, MCPUBs, JTR, DoD Forms and more.">
<meta name="theme-color" content="#1a1a1a">
<link rel="icon" type="image/svg+xml" href="icon.svg">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.svg">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="stylesheet" href="style.css?v=23">
<link rel="stylesheet" href="ai-improvements.css?v=2">
</head>
<body>
<!-- Skip Navigation Link for Keyboard Accessibility -->
<a href="#main-content" class="skip-link">Skip to main content</a>

<header>
  <a href="https://linktr.ee/semperadmin" target="_blank" class="branding-link" aria-label="Visit Semper Admin on Linktree (opens in new tab)">
    <div class="branding">
      <img src="logo.png" alt="Message Watch Logo" class="header-logo">
      <div class="header-text">
        <h1>Message Watch</h1>
        <p class="byline">by Semper Admin</p>
      </div>
    </div>
  </a>
  <p class="subtitle">Monitor military directives, messages, and publications</p>
  <div class="controls">
    <button id="refreshBtn" aria-label="Refresh data from server"><i class="fa-solid fa-arrows-rotate"></i> Refresh</button>
    <button id="themeToggle" aria-label="Toggle dark mode"><i class="fa-solid fa-moon"></i> Dark Mode</button>
  </div>
</header>
<main id="main-content">
  <div class="message-type-tabs" role="tablist" aria-label="Message type selection">
    <button class="message-type-btn" data-type="almar" role="tab" aria-selected="false" aria-controls="results">ALMARs <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="alnav" role="tab" aria-selected="false" aria-controls="results">ALNAVs <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="dodfmr" role="tab" aria-selected="false" aria-controls="results">DoD FMR <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="dodforms" role="tab" aria-selected="false" aria-controls="results">DoD Forms <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="igmc" role="tab" aria-selected="false" aria-controls="results">IGMC <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn active" data-type="maradmin" role="tab" aria-selected="true" aria-controls="results">MARADMINs <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="jtr" role="tab" aria-selected="false" aria-controls="results">JTR <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="mcpub" role="tab" aria-selected="false" aria-controls="results">MCPUBs <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="secnav" role="tab" aria-selected="false" aria-controls="results">SECNAV <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn" data-type="youtube" role="tab" aria-selected="false" aria-controls="results">YouTube <span class="tab-counter" aria-label="0 messages">0</span></button>
    <button class="message-type-btn all-messages-btn" data-type="all" role="tab" aria-selected="false" aria-controls="results">All Messages <span class="tab-counter" aria-label="0 messages">0</span></button>
  </div>
  <div class="filters-section">
    <div class="search-container">
      <label for="searchInput" class="sr-only">Search messages</label>
      <input type="text" id="searchInput" placeholder="Search by ID, subject, or keywords..." aria-describedby="searchHelp" />
      <button id="clearSearch" class="clear-btn" aria-label="Clear search">âœ•</button>
      <span id="searchHelp" class="sr-only">Enter keywords to filter messages</span>
    </div>
    <div class="filter-controls">
      <div class="quick-filters" role="group" aria-label="Date range filters">
        <button class="quick-filter-btn" data-days="1" aria-pressed="false">Today</button>
        <button class="quick-filter-btn active" data-days="7" aria-pressed="true">This Week</button>
        <button class="quick-filter-btn" data-days="14" aria-pressed="false">2 Weeks</button>
        <button class="quick-filter-btn" data-days="30" aria-pressed="false">This Month</button>
        <button class="quick-filter-btn" data-days="60" aria-pressed="false">60 Days</button>
        <button class="quick-filter-btn" data-days="90" aria-pressed="false">90 Days</button>
        <button class="quick-filter-btn" data-days="180" aria-pressed="false">180 Days</button>
        <button class="quick-filter-btn" data-days="0" aria-pressed="false">All</button>
      </div>
    </div>
  </div>
  <div id="status" class="status" role="status" aria-live="polite">Loading cached data...</div>
  <div id="error" class="error hidden" role="alert" aria-live="assertive"></div>
  <div id="summaryStats" class="summary-stats hidden"></div>
  <div id="results" class="results" role="tabpanel" aria-label="Message results" tabindex="-1"></div>
</main>
<footer>
  <p class="semper-admin-branding">
    A <a href="https://linktr.ee/semperadmin" target="_blank" aria-label="Semper Admin (opens in new tab)">Semper Admin</a> Project
  </p>
  <p>Data source Last updated: <span id="lastUpdate">Never</span></p>
  <p class="footer-note">Auto-refreshes every 10 minutes â€¢ Data cached for offline access</p>
</footer>

<!-- Feedback Widget -->
<button id="feedbackBtn" class="feedback-btn" title="Share Feedback">ðŸ’¬ Feedback</button>

<!-- Feedback Modal -->
<div id="feedbackModal" class="feedback-modal hidden" role="dialog" aria-modal="true" aria-labelledby="feedbackModalTitle">
  <div class="feedback-modal-content">
    <div class="feedback-modal-header">
      <h2 id="feedbackModalTitle">Share Your Feedback</h2>
      <button id="closeFeedbackModal" class="feedback-close-btn" aria-label="Close feedback modal">âœ•</button>
    </div>
    <form id="feedbackForm">
      <div class="feedback-form-group">
        <label for="feedbackType">Feedback Type <span class="required">*</span></label>
        <select id="feedbackType" required>
          <option value="">Select type...</option>
          <option value="bug">Bug Report</option>
          <option value="feature">Feature Request</option>
          <option value="ux">UX Suggestion</option>
        </select>
      </div>

      <div class="feedback-form-group">
        <label for="feedbackTitle">Title <span class="required">*</span></label>
        <input type="text" id="feedbackTitle" placeholder="Brief summary of your feedback" required maxlength="100">
      </div>

      <div class="feedback-form-group">
        <label for="feedbackDescription">Description <span class="required">*</span></label>
        <textarea id="feedbackDescription" placeholder="Please describe your feedback in detail..." required rows="6"></textarea>
      </div>

      <div class="feedback-form-group">
        <label for="feedbackEmail">Email (Optional - will be public in GitHub issue)</label>
        <input type="email" id="feedbackEmail" placeholder="your@email.mil (visible publicly)" aria-describedby="emailPrivacyNote">
        <small id="emailPrivacyNote"><i class="fa-solid fa-triangle-exclamation"></i> Your email will be visible in the public GitHub issue</small>
      </div>

      <div class="feedback-form-actions">
        <button type="button" id="cancelFeedback" class="feedback-btn-secondary">Cancel</button>
        <button type="submit" class="feedback-btn-primary">Submit Feedback</button>
      </div>

      <div id="feedbackStatus" class="feedback-status hidden"></div>
    </form>
  </div>
</div>

<script src="lib/fa-checklists.js"></script>
<script src="lib/secnav-data.js"></script>
<script src="lib/alnav-data.js"></script>
<script src="lib/youtube-data.js"></script>

<!--Web Vitals Library - Official Google library for Core Web Vitals -->
<!-- TODO: Download and host locally for better security (avoid CDN dependency) -->
<!-- SRI hash protects against CDN compromise - if load fails due to hash mismatch: -->
<!-- curl -sL https://unpkg.com/web-vitals@3.5.0/dist/web-vitals.iife.js | openssl dgst -sha384 -binary | openssl base64 -A -->
<script src="https://unpkg.com/web-vitals@3.5.0/dist/web-vitals.iife.js"
        integrity="sha384-KBS/51Z54arAwgWuZJk7sWuvk7WXIMUv2d7TDOS0ZHL0gx3Nx7RXtxlilnaYHU2D"
        crossorigin="anonymous"></script>

<script src="app.js?v=25"></script>

<!-- Service Worker Registration for PWA -->
<script src="pwa-init.js"></script>
</body>
</html>
