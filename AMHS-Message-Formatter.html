<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semper Admin - AMHS Message Formatter Updated: 20251010</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.4;
        }
        
        .header {
            max-width: 1200px;
            margin: 0 auto 30px;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            border: 3px solid #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .logo {
            font-size: 36px;
            font-weight: bold;
            color: #00ff00;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        .logo-subtext {
            font-size: 12px;
            color: #00cc00;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 14px;
            color: #008800;
            font-style: italic;
            margin-top: 10px;
            border-top: 1px solid #004400;
            padding-top: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #0d0d0d;
            border: 2px solid #00ff00;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #00ff00;
            text-transform: uppercase;
            font-size: 24px;
        }
        
        .section {
            margin-bottom: 25px;
            border: 1px solid #004400;
            padding: 15px;
            background: #050505;
        }
        
        .section-title {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 14px;
            border-bottom: 1px solid #003300;
            padding-bottom: 5px;
        }
        
        .tooltip {
            display: inline-block;
            position: relative;
            margin-left: 5px;
            cursor: help;
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            text-align: center;
            line-height: 14px;
            font-size: 12px;
        }
        
        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            left: 0;
            top: 25px;
            background: #000;
            border: 1px solid #00ff00;
            color: #00cc00;
            padding: 8px;
            white-space: normal;
            width: 250px;
            z-index: 1000;
            font-size: 11px;
            line-height: 1.3;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #00cc00;
            font-size: 12px;
        }
        
        input[type="text"],
        textarea,
        select {
            width: 100%;
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.4);
        }
        
        textarea {
            resize: vertical;
            min-height: 200px;
        }
        
        button {
            background: #004400;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #006600;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        button:active {
            background: #008800;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .ref-item, .poc-item {
            border: 1px solid #003300;
            padding: 10px;
            margin-bottom: 10px;
            background: #000;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .preview {
            background: #000;
            border: 1px solid #00ff00;
            padding: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        
        .validation-panel {
            background: #0a0a0a;
            border: 1px solid #00ff00;
            padding: 10px;
            margin-bottom: 15px;
            display: none;
        }
        
        .validation-panel.show {
            display: block;
        }
        
        .validation-item {
            padding: 5px;
            margin: 3px 0;
            font-size: 11px;
            color: #ff0000;
        }
        
        .footer {
            margin-top: 30px;
            padding: 20px;
            border-top: 2px solid #004400;
            text-align: center;
            color: #006600;
            font-size: 11px;
        }
        
        .footer a {
            color: #00ff00;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .version {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 10px;
            color: #004400;
        }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: #0d0d0d;
            border: 2px solid #00ff00;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-bottom: 1px solid #003300;
            padding-bottom: 10px;
        }
        
        .modal-close {
            color: #ff0000;
            font-size: 20px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
        }
        
        .template-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #003300;
            margin-bottom: 8px;
            background: #000;
        }
        
        .template-name {
            color: #00ff00;
            font-size: 12px;
        }
        
        .template-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 11px;
        }
        
        .flex-row {
            display: flex;
            gap: 8px;
        }
        
        .flex-1 {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="version">v2.0</div>
    
    <div class="header">
        <div class="logo">SEMPER ADMIN</div>
        <div class="logo-subtext">OPERATIONAL EXCELLENCE THROUGH AUTOMATION</div>
        <div class="tagline">"Streamlining Marine Corps Administration - One Message at a Time"</div>
    </div>
    
    <div class="container">
        <h1>AMHS Message Formatter</h1>
        
        <!-- Message Type & Classification -->
        <div class="section">
            <div class="section-title">
                Message Type & Classification
                <span class="tooltip" data-tip="Select the type of message and its classification level. Classification determines network routing and handling procedures.">?</span>
            </div>
            <div class="grid-3">
                <div>
                    <label>Message Type:</label>
                    <select id="msgType">
                        <option value="GENADMIN">GENADMIN</option>
                        <option value="MARADMIN">MARADMIN</option>
                        <option value="ALMAR">ALMAR</option>
                    </select>
                </div>
                <div>
                    <label>Classification:</label>
                    <select id="classification">
                        <option value="UNCLASSIFIED">UNCLASSIFIED</option>
                        <option value="CONFIDENTIAL">CONFIDENTIAL</option>
                        <option value="SECRET">SECRET</option>
                        <option value="TOP SECRET">TOP SECRET</option>
                    </select>
                </div>
                <div>
                    <label>
                        Precedence:
                        <span class="tooltip" data-tip="ROUTINE: 6hr | PRIORITY: 3hr | IMMEDIATE: 30min | FLASH: <10min">?</span>
                    </label>
                    <select id="precedence">
                        <option value="ROUTINE">ROUTINE (R)</option>
                        <option value="PRIORITY">PRIORITY (P)</option>
                        <option value="IMMEDIATE">IMMEDIATE (O)</option>
                        <option value="FLASH">FLASH (Z)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Header Fields -->
        <div class="section">
            <div class="section-title">
                Message Header
                <span class="tooltip" data-tip="Addressees (TO/INFO) will be added in AMHS system after pasting this message.">?</span>
            </div>
            <div class="grid-2">
                <div>
                    <label>
                        Date-Time Group (DTG):
                        <span class="tooltip" data-tip="Format: DDHHMM(Z)MMMYY. Auto-generated in Zulu (GMT) time.">?</span>
                    </label>
                    <div class="flex-row">
                        <input type="text" id="dtg" placeholder="101445ZOCT25" class="flex-1">
                        <button onclick="generateDTG()">Refresh</button>
                    </div>
                </div>
                <div>
                    <label>Office Code (Optional):</label>
                    <input type="text" id="officeCode" placeholder="MRA MM">
                </div>
            </div>
            <div>
                <label>
                    Originator (FROM):
                    <span class="tooltip" data-tip="Enter the originating command in plain language. Example: CMC WASHINGTON DC">?</span>
                </label>
                <input type="text" id="originator" placeholder="CMC WASHINGTON DC">
            </div>
            <div>
                <label>
                    Subject (SUBJ):
                    <span class="tooltip" data-tip="Describe message purpose concisely in all caps. Will auto-format across multiple lines in preview.">?</span>
                </label>
                <input type="text" id="subject" placeholder="YOUR SUBJECT IN ALL CAPS">
            </div>
        </div>
        
        <!-- References -->
        <div class="section">
            <div class="section-title">
                References (REF/NARR)
                <span class="tooltip" data-tip="Cite supporting documents. Format: REF/A/MSGID: DOC/MCO 5354.1G//. NARR field describes each reference.">?</span>
            </div>
            <div id="referencesContainer"></div>
            <div class="button-group">
                <button onclick="addReference()">+ Add Reference</button>
                <button onclick="generateNarrative()">Generate NARR/</button>
            </div>
            <div style="margin-top: 15px;">
                <label>Generated Narrative:</label>
                <textarea id="narrative" readonly rows="4" placeholder="Generated narrative text will appear here (NARR/ and // added automatically in preview)..."></textarea>
            </div>
        </div>
        
        <!-- POC Builder -->
        <div class="section">
            <div class="section-title">
                Point of Contact (POC)
                <span class="tooltip" data-tip="List primary and alternate POCs for follow-up questions.">?</span>
            </div>
            <div id="pocsContainer"></div>
            <button onclick="addPOC()">+ Add POC</button>
        </div>
        
        <!-- Message Text -->
        <div class="section">
            <div class="section-title">
                Message Text (GENTEXT/REMARKS)
                <span class="tooltip" data-tip="Enter message body. Paragraph buttons auto-number based on context. Example: After 3.B., clicking 'Sub Para' creates 3.C. Clicking 'Sub-Sub Para' creates 3.B.1.">?</span>
            </div>
            <div class="button-group">
                <button onclick="insertParagraph('main')">1. Main Para</button>
                <button onclick="insertParagraph('sub-a')">1.A. Sub Para</button>
                <button onclick="insertParagraph('sub-1')">1.A.1. Sub-Sub Para</button>
                <button onclick="insertParagraph('sub-a2')">1.A.1.A. Sub-Sub-Sub</button>
            </div>
            <textarea id="messageText" placeholder="Enter message text here..."></textarea>
        </div>
        
        <!-- Validation Panel -->
        <div class="validation-panel" id="validationPanel">
            <div class="section-title">Validation Errors:</div>
            <div id="validationResults"></div>
        </div>
        
        <!-- Actions -->
        <div class="button-group">
            <button onclick="validateMessage()">Validate Message</button>
            <button onclick="generatePreview()">Generate Preview</button>
            <button onclick="copyToClipboard()">Copy to Clipboard</button>
            <button onclick="downloadMessage()">Download .TXT</button>
            <button onclick="saveTemplate()">Save Template</button>
            <button onclick="showTemplateModal()">Load Template</button>
            <button onclick="clearAll()">Clear All</button>
        </div>
        
        <!-- Preview -->
        <div class="section">
            <div class="section-title">Message Preview</div>
            <div class="preview" id="messagePreview">Preview will appear here...</div>
        </div>
        
        <div class="footer">
            <em>Follow Semper Admin on all platforms: <a href="https://linktr.ee/semperadmin" target="_blank" style="color: #1e40af; text-decoration: underline;"><strong style="color: #00ff00;">SEMPER ADMIN</strong></a></em><br> | Developed for Marines, by Marines<br>
            For support or feedback, contact your local S-1 or submit via command channels<br>
            
            <em>Not affiliated with or endorsed by HQMC | Unofficial tool for administrative efficiency</em>
        </div>
    </div>
    
    <!-- Template Modal -->
    <div class="modal" id="templateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: #00ff00;">LOAD TEMPLATE</h3>
                <button class="modal-close" onclick="hideTemplateModal()">X</button>
            </div>
            <div id="templateList"></div>
        </div>
    </div>

    <script>
        let refCounter = 0;
        let pocCounter = 0;
        
        document.addEventListener('DOMContentLoaded', function() {
            generateDTG();
            
            const uppercaseFields = ['originator', 'subject', 'officeCode'];
            uppercaseFields.forEach(function(id) {
                document.getElementById(id).addEventListener('input', function(e) {
                    this.value = this.value.toUpperCase();
                });
            });
        });
        
        function generateDTG() {
            const now = new Date();
            const day = String(now.getUTCDate()).padStart(2, '0');
            const hours = String(now.getUTCHours()).padStart(2, '0');
            const minutes = String(now.getUTCMinutes()).padStart(2, '0');
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            const month = months[now.getUTCMonth()];
            const year = String(now.getUTCFullYear()).slice(-2);
            document.getElementById('dtg').value = day + hours + minutes + 'Z' + month + year;
        }
        
        function addReference() {
            refCounter++;
            const letter = String.fromCharCode(64 + refCounter);
            const container = document.getElementById('referencesContainer');
            
            const div = document.createElement('div');
            div.className = 'ref-item';
            div.id = 'ref-' + refCounter;
            div.innerHTML = '<div class="item-header"><strong>REF/' + letter + '/</strong><button onclick="removeReference(' + refCounter + ')" class="btn-small">Remove</button></div><div><label>Type:</label><select id="refType-' + refCounter + '"><option value="MSGID: DOC">MSGID: DOC</option><option value="MSGID: MSG">MSGID: MSG</option><option value="DOC">DOC</option><option value="MSG">MSG</option><option value="LTR">LTR</option><option value="MEMO">MEMO</option></select></div><div><label>Document Identifier:</label><input type="text" id="refDoc-' + refCounter + '" placeholder="MCO 5354.1G or 061341ZOCT25"></div><div><label>Full Title for NARR:</label><input type="text" id="refTitle-' + refCounter + '" placeholder="PROHIBITED ACTIVITIES AND CONDUCT PREVENTION AND RESPONSE POLICY"></div>';
            container.appendChild(div);
            
            document.getElementById('refDoc-' + refCounter).addEventListener('input', function(e) {
                this.value = this.value.toUpperCase();
            });
        }
        
        function removeReference(id) {
            document.getElementById('ref-' + id).remove();
            renumberReferences();
        }
        
        function renumberReferences() {
            const refs = document.querySelectorAll('.ref-item');
            refs.forEach(function(ref, index) {
                const letter = String.fromCharCode(65 + index);
                ref.querySelector('.item-header strong').textContent = 'REF/' + letter + '/';
            });
        }
        
        function generateNarrative() {
            const refs = document.querySelectorAll('.ref-item');
            let narrative = '';
            
            refs.forEach(function(ref, index) {
                const letter = String.fromCharCode(65 + index);
                const id = ref.id.split('-')[1];
                const title = document.getElementById('refTitle-' + id).value;
                
                if (title) {
                    narrative += 'REF ' + letter + ' IS THE ' + title.toUpperCase() + '. ';
                }
            });
            
            document.getElementById('narrative').value = narrative.trim() || 'NO REFERENCES';
        }
        
        function addPOC() {
            pocCounter++;
            const container = document.getElementById('pocsContainer');
            
            const div = document.createElement('div');
            div.className = 'poc-item';
            div.id = 'poc-' + pocCounter;
            div.innerHTML = '<div class="item-header"><strong>POC Entry</strong><button onclick="removePOC(' + pocCounter + ')" class="btn-small">Remove</button></div><div class="grid-3"><div><label>Name (LAST, FIRST):</label><input type="text" id="pocName-' + pocCounter + '" placeholder="MORALES, J. K."></div><div><label>Rank:</label><input type="text" id="pocRank-' + pocCounter + '" placeholder="MSGT"></div><div><label>Unit:</label><input type="text" id="pocUnit-' + pocCounter + '" placeholder="MRA/MPE"></div></div><div class="grid-2"><div><label>Phone:</label><input type="text" id="pocPhone-' + pocCounter + '" placeholder="(703)784-6164"></div><div><label>Email:</label><input type="text" id="pocEmail-' + pocCounter + '" placeholder="FIRSTNAME.LASTNAME@USMC.MIL"></div></div>';
            container.appendChild(div);
            
            const pocFields = ['pocName', 'pocRank', 'pocUnit', 'pocEmail'];
            pocFields.forEach(function(field) {
                document.getElementById(field + '-' + pocCounter).addEventListener('input', function(e) {
                    this.value = this.value.toUpperCase();
                });
            });
        }
        
        function removePOC(id) {
            document.getElementById('poc-' + id).remove();
        }
        
        function parseLastParagraph(textBeforeCursor) {
            const lines = textBeforeCursor.split('\n');
            
            for (let i = lines.length - 1; i >= 0; i--) {
                const line = lines[i].trim();
                
                const subsubsubMatch = line.match(/^(\d+)\.([A-Z])\.(\d+)\.([A-Z])\.\s?/);
                if (subsubsubMatch) {
                    return { level: 'subsubsub', main: parseInt(subsubsubMatch[1]), sub: subsubsubMatch[2], subsub: parseInt(subsubsubMatch[3]), subsubsub: subsubsubMatch[4] };
                }
                
                const subsubMatch = line.match(/^(\d+)\.([A-Z])\.(\d+)\.\s?/);
                if (subsubMatch) {
                    return { level: 'subsub', main: parseInt(subsubMatch[1]), sub: subsubMatch[2], subsub: parseInt(subsubMatch[3]), subsubsub: null };
                }
                
                const subMatch = line.match(/^(\d+)\.([A-Z])\.\s?/);
                if (subMatch) {
                    return { level: 'sub', main: parseInt(subMatch[1]), sub: subMatch[2], subsub: null, subsubsub: null };
                }
                
                const mainMatch = line.match(/^(\d+)\.\s?/);
                if (mainMatch) {
                    return { level: 'main', main: parseInt(mainMatch[1]), sub: null, subsub: null, subsubsub: null };
                }
            }
            
            return { level: 'none', main: 0, sub: null, subsub: null, subsubsub: null };
        }
        
function parseLastParagraph(textBeforeCursor) {
            const lines = textBeforeCursor.split('\n');
            
            for (let i = lines.length - 1; i >= 0; i--) {
                const line = lines[i].trim();
                
                const subsubsubMatch = line.match(/^(\d+)\.([A-Z])\.(\d+)\.([A-Z])\.\s?/);
                if (subsubsubMatch) {
                    return { level: 'subsubsub', main: parseInt(subsubsubMatch[1]), sub: subsubsubMatch[2], subsub: parseInt(subsubsubMatch[3]), subsubsub: subsubsubMatch[4] };
                }
                
                const subsubMatch = line.match(/^(\d+)\.([A-Z])\.(\d+)\.\s?/);
                if (subsubMatch) {
                    return { level: 'subsub', main: parseInt(subsubMatch[1]), sub: subsubMatch[2], subsub: parseInt(subsubMatch[3]), subsubsub: null };
                }
                
                const subMatch = line.match(/^(\d+)\.([A-Z])\.\s?/);
                if (subMatch) {
                    return { level: 'sub', main: parseInt(subMatch[1]), sub: subMatch[2], subsub: null, subsubsub: null };
                }
                
                const mainMatch = line.match(/^(\d+)\.\s?/);
                if (mainMatch) {
                    return { level: 'main', main: parseInt(mainMatch[1]), sub: null, subsub: null, subsubsub: null };
                }
            }
            
            return { level: 'none', main: 0, sub: null, subsub: null, subsubsub: null };
        }
        
        function insertParagraph(type) {
            const textarea = document.getElementById('messageText');
            const cursorPos = textarea.selectionStart;
            const text = textarea.value;
            const textBeforeCursor = text.slice(0, cursorPos);
            
            const context = parseLastParagraph(textBeforeCursor);
            let insert = '';
            
            if (type === 'main') {
                const nextMain = context.main + 1;
                insert = '\n' + nextMain + '. ';
                
            } else if (type === 'sub-a') {
                if (context.level === 'none' || context.level === 'main') {
                    const mainNum = context.main || 1;
                    insert = '\n' + mainNum + '.A. ';
                } else if (context.level === 'sub') {
                    const nextLetter = String.fromCharCode(context.sub.charCodeAt(0) + 1);
                    insert = '\n' + context.main + '.' + nextLetter + '. ';
                } else if (context.level === 'subsub' || context.level === 'subsubsub') {
                    const nextLetter = String.fromCharCode(context.sub.charCodeAt(0) + 1);
                    insert = '\n' + context.main + '.' + nextLetter + '. ';
                }
                
            } else if (type === 'sub-1') {
                if (context.level === 'sub') {
                    insert = '\n' + context.main + '.' + context.sub + '.1. ';
                } else if (context.level === 'subsub') {
                    const nextNum = context.subsub + 1;
                    insert = '\n' + context.main + '.' + context.sub + '.' + nextNum + '. ';
                } else if (context.level === 'subsubsub') {
                    const nextNum = context.subsub + 1;
                    insert = '\n' + context.main + '.' + context.sub + '.' + nextNum + '. ';
                } else {
                    insert = '\n1.A.1. ';
                }
                
            } else if (type === 'sub-a2') {
                if (context.level === 'subsub') {
                    insert = '\n' + context.main + '.' + context.sub + '.' + context.subsub + '.A. ';
                } else if (context.level === 'subsubsub') {
                    const nextLetter = String.fromCharCode(context.subsubsub.charCodeAt(0) + 1);
                    insert = '\n' + context.main + '.' + context.sub + '.' + context.subsub + '.' + nextLetter + '. ';
                } else {
                    insert = '\n1.A.1.A. ';
                }
            }
            
            textarea.value = text.slice(0, cursorPos) + insert + text.slice(cursorPos);
            textarea.selectionStart = textarea.selectionEnd = cursorPos + insert.length;
            textarea.focus();
        }
        
        function formatToAMHSLines(text, maxChars) {
            if (!maxChars) maxChars = 65;
            const words = text.split(' ');
            const lines = [];
            let currentLine = '';
            
            words.forEach(function(word) {
                const testLine = currentLine ? currentLine + ' ' + word : word;
                if (testLine.length <= maxChars) {
                    currentLine = testLine;
                } else {
                    if (currentLine) lines.push(currentLine);
                    currentLine = word;
                }
            });
            
            if (currentLine) lines.push(currentLine);
            return lines.join('\n');
        }
        
        function formatPOC(poc) {
            let pocLine = 'POC/' + poc.name;
            if (poc.rank) pocLine += '/' + poc.rank;
            if (poc.unit) pocLine += '/' + poc.unit;
            if (poc.phone) pocLine += '/TEL: ' + poc.phone;
            
            if (poc.email) {
                const emailPart = '/EMAIL: ' + poc.email;
                if ((pocLine + emailPart).length > 65) {
                    return pocLine + '\nEMAIL: ' + poc.email;
                } else {
                    pocLine += emailPart;
                }
            }
            
            return pocLine;
        }
        
        function validateMessage() {
            const errors = [];
            
            if (!document.getElementById('originator').value.trim()) {
                errors.push('Originator (FROM) is required');
            }
            if (!document.getElementById('subject').value.trim()) {
                errors.push('Subject is required');
            }
            if (!document.getElementById('messageText').value.trim()) {
                errors.push('Message text is required');
            }
            if (!document.getElementById('dtg').value) {
                errors.push('Date-Time Group is required');
            }
            
            const refs = document.querySelectorAll('.ref-item');
            refs.forEach(function(ref, idx) {
                const letter = String.fromCharCode(65 + idx);
                const id = ref.id.split('-')[1];
                const title = document.getElementById('refTitle-' + id).value;
                const doc = document.getElementById('refDoc-' + id).value;
                
                if (title && !doc) {
                    errors.push('Reference ' + letter + ' has title but missing document identifier');
                }
            });
            
            const panel = document.getElementById('validationPanel');
            const results = document.getElementById('validationResults');
            
            if (errors.length > 0) {
                panel.classList.add('show');
                results.innerHTML = errors.map(function(e) {
                    return '<div class="validation-item">X ' + e + '</div>';
                }).join('');
                return false;
            } else {
                panel.classList.remove('show');
                return true;
            }
        }
        
        function generatePreview() {
            const classification = document.getElementById('classification').value;
            const precedence = document.getElementById('precedence').value;
            const dtg = document.getElementById('dtg').value;
            const originator = document.getElementById('originator').value;
            const officeCode = document.getElementById('officeCode').value;
            const subject = document.getElementById('subject').value;
            const narrative = document.getElementById('narrative').value;
            const messageText = document.getElementById('messageText').value;
            
            let msg = classification + '//\n';
            msg += precedence + '\n';
            msg += dtg + '\n';
            msg += 'FM ' + originator;
            if (officeCode) msg += '/' + officeCode;
            msg += '//\n';
            msg += 'BT\n';
            msg += classification + '//\n';
            msg += 'MSGID/GENADMIN/' + originator;
            if (officeCode) msg += '/' + officeCode;
            msg += '//\n';
            
            const subjFormatted = formatToAMHSLines(subject);
            msg += 'SUBJ/' + subjFormatted + '//\n';
            
            const refs = document.querySelectorAll('.ref-item');
            refs.forEach(function(ref, idx) {
                const letter = String.fromCharCode(65 + idx);
                const id = ref.id.split('-')[1];
                const type = document.getElementById('refType-' + id).value;
                const doc = document.getElementById('refDoc-' + id).value;
                
                if (doc) {
                    msg += 'REF/' + letter + '/' + type + '/' + doc + '//\n';
                }
            });
            
            if (narrative && narrative !== 'NO REFERENCES') {
                const narrFormatted = formatToAMHSLines(narrative);
                msg += 'NARR/' + narrFormatted + '//\n';
            }
            
            const pocs = document.querySelectorAll('.poc-item');
            pocs.forEach(function(poc) {
                const id = poc.id.split('-')[1];
                const name = document.getElementById('pocName-' + id).value;
                const rank = document.getElementById('pocRank-' + id).value;
                const unit = document.getElementById('pocUnit-' + id).value;
                const phone = document.getElementById('pocPhone-' + id).value;
                const email = document.getElementById('pocEmail-' + id).value;
                
                if (name) {
                    msg += formatPOC({name: name, rank: rank, unit: unit, phone: phone, email: email}) + '//\n';
                }
            });
            
            const formattedText = messageText.split('\n').map(function(line) {
                if (!line.trim() || line.length <= 65) return line;
                return formatToAMHSLines(line);
            }).join('\n');
            
            msg += 'GENTEXT/REMARKS/' + formattedText + '//\n';
            msg += 'BT\n';
            msg += classification + '//';
            
            document.getElementById('messagePreview').textContent = msg;
            return msg;
        }
        
        function copyToClipboard() {
            if (!validateMessage()) {
                alert('Please fix validation errors before copying.');
                return;
            }
            
            const msg = generatePreview();
            navigator.clipboard.writeText(msg).then(function() {
                alert('Message copied to clipboard!');
            }).catch(function() {
                alert('Failed to copy. Please select and copy manually.');
            });
        }
        
        function downloadMessage() {
            if (!validateMessage()) {
                alert('Message validation failed. Please fix errors before downloading.');
                return;
            }
            
            const msg = generatePreview();
            const blob = new Blob([msg], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            const msgType = document.getElementById('msgType').value;
            const date = new Date().toISOString().slice(0, 10).replace(/-/g, '');
            a.download = 'SEMPERADMIN_' + msgType + '_' + date + '.txt';
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function saveTemplate() {
            const name = prompt('Template name:', 'template_' + Date.now());
            if (!name) return;
            
            const template = {
                msgType: document.getElementById('msgType').value,
                classification: document.getElementById('classification').value,
                precedence: document.getElementById('precedence').value,
                originator: document.getElementById('originator').value,
                subject: document.getElementById('subject').value,
                officeCode: document.getElementById('officeCode').value,
                dtg: document.getElementById('dtg').value,
                narrative: document.getElementById('narrative').value,
                messageText: document.getElementById('messageText').value,
                references: [],
                pocs: []
            };
            
            document.querySelectorAll('.ref-item').forEach(function(ref) {
                const id = ref.id.split('-')[1];
                template.references.push({
                    type: document.getElementById('refType-' + id).value,
                    document: document.getElementById('refDoc-' + id).value,
                    title: document.getElementById('refTitle-' + id).value
                });
            });
            
            document.querySelectorAll('.poc-item').forEach(function(poc) {
                const id = poc.id.split('-')[1];
                template.pocs.push({
                    name: document.getElementById('pocName-' + id).value,
                    rank: document.getElementById('pocRank-' + id).value,
                    unit: document.getElementById('pocUnit-' + id).value,
                    phone: document.getElementById('pocPhone-' + id).value,
                    email: document.getElementById('pocEmail-' + id).value
                });
            });
            
            localStorage.setItem('semperadmin_template_' + name, JSON.stringify(template));
            alert('Template saved!');
        }
        
        function showTemplateModal() {
            const keys = Object.keys(localStorage).filter(function(k) {
                return k.startsWith('semperadmin_template_');
            });
            const list = document.getElementById('templateList');
            
            if (keys.length === 0) {
                list.innerHTML = '<p style="color: #008800; font-size: 12px;">No saved templates found.</p>';
            } else {
                list.innerHTML = keys.map(function(key) {
                    const name = key.replace('semperadmin_template_', '');
                    return '<div class="template-item"><span class="template-name">' + name + '</span><div class="template-actions"><button onclick="loadTemplate(\'' + key + '\')" class="btn-small">Load</button><button onclick="deleteTemplate(\'' + key + '\')" class="btn-small">Delete</button></div></div>';
                }).join('');
            }
            
            document.getElementById('templateModal').classList.add('show');
        }
        
        function hideTemplateModal() {
            document.getElementById('templateModal').classList.remove('show');
        }
        
        function loadTemplate(key) {
            const data = JSON.parse(localStorage.getItem(key));
            
            document.getElementById('msgType').value = data.msgType;
            document.getElementById('classification').value = data.classification;
            document.getElementById('precedence').value = data.precedence;
            document.getElementById('originator').value = data.originator;
            document.getElementById('subject').value = data.subject;
            document.getElementById('officeCode').value = data.officeCode;
            document.getElementById('dtg').value = data.dtg;
            document.getElementById('narrative').value = data.narrative;
            document.getElementById('messageText').value = data.messageText;
            
            document.getElementById('referencesContainer').innerHTML = '';
            refCounter = 0;
            data.references.forEach(function(ref) {
                addReference();
                const id = refCounter;
                document.getElementById('refType-' + id).value = ref.type;
                document.getElementById('refDoc-' + id).value = ref.document;
                document.getElementById('refTitle-' + id).value = ref.title;
            });
            
            document.getElementById('pocsContainer').innerHTML = '';
            pocCounter = 0;
            data.pocs.forEach(function(poc) {
                addPOC();
                const id = pocCounter;
                document.getElementById('pocName-' + id).value = poc.name;
                document.getElementById('pocRank-' + id).value = poc.rank;
                document.getElementById('pocUnit-' + id).value = poc.unit;
                document.getElementById('pocPhone-' + id).value = poc.phone;
                document.getElementById('pocEmail-' + id).value = poc.email;
            });
            
            hideTemplateModal();
            alert('Template loaded!');
        }
        
        function deleteTemplate(key) {
            if (confirm('Delete this template?')) {
                localStorage.removeItem(key);
                showTemplateModal();
            }
        }
        
        function clearAll() {
            if (confirm('Clear all fields?')) {
                document.getElementById('originator').value = '';
                document.getElementById('subject').value = '';
                document.getElementById('officeCode').value = '';
                document.getElementById('messageText').value = '';
                document.getElementById('narrative').value = '';
                document.getElementById('referencesContainer').innerHTML = '';
                document.getElementById('pocsContainer').innerHTML = '';
                document.getElementById('messagePreview').textContent = 'Preview will appear here...';
                document.getElementById('validationPanel').classList.remove('show');
                refCounter = 0;
                pocCounter = 0;
                generateDTG();
            }
        }
    </script>

<button id="feedbackBtn" class="feedback-btn" title="Share Feedback">ðŸ’¬ Feedback</button>
<style>
  .feedback-btn {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: linear-gradient(135deg, #006600 0%, #004400 100%);
    color: #00ff00;
    border: 2px solid #00ff00;
    padding: 0.75rem 1.25rem;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 255, 0, 0.3);
    transition: all 0.3s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Courier New', monospace;
  }

  .feedback-btn:hover {
    background: linear-gradient(135deg, #008800 0%, #006600 100%);
    box-shadow: 0 6px 16px rgba(0, 255, 0, 0.5);
    transform: translateY(-2px);
  }

  .feedback-btn:active {
    transform: translateY(0);
    background: #00aa00;
  }
</style>
<script>
  const feedbackBtn = document.getElementById('feedbackBtn');

  feedbackBtn.addEventListener('click', () => {
    window.location.href = "https://semperadmin.github.io/Sentinel/#detail/amhs-message-formatter/todo";
  });
</script>
</body>
</html>
